{"version":3,"sources":["../../src/factories/data_fcty.js"],"names":[],"mappings":";;;;;;;;;;AACA,IAAM,CAAC,GAAa,OAAO,CAAC,QAAQ,CAAC,CAAC;AACtC,IAAM,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;;IAErC,QAAQ;YAAR,QAAQ;;WAAR,QAAQ;0BAAR,QAAQ;;+BAAR,QAAQ;;;eAAR,QAAQ;;WAER,gBAAE;AACJ,UAAI,CAAC,KAAK,GAAG,EAAE,CAAC;AAChB,UAAI,CAAC,UAAU,GAAG,EAAE,CAAC;AACrB,UAAI,CAAC,IAAI,GAAS,CAAC,CAAC;AACpB,UAAI,CAAC,MAAM,GAAO,CAAC,CAAC;AACpB,UAAI,CAAC,cAAc,GAAG,IAAI,CAAC;KAC5B;;;WAEW,sBAAC,CAAC,EAAC;AACb,UAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAC;AACd,eAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;OACtB,MAAM;AACL,eAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;OACtB;KACF;;;WAEU,qBAAC,GAAG,EAAC;AACd,UAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAC;AACxB,YAAI,CAAC,YAAY,EAAE,CAAC;AACpB,YAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,UAAC,CAAC,EAAG;AAC7B,cAAI,QAAQ,GAAG,KAAK,CAAC;AACrB,cAAI,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACrB,cAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAC;AAChB,oBAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;WAChC,MAAM;AACL,oBAAQ,GAAG,GAAG,KAAK,EAAE,CAAC;WACvB;;AAED,WAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AAChC,iBAAO,CAAC,CAAC;SACV,CAAC,CAAC;OACJ;KAEF;;;WAEK,gBAAC,GAAG,EAAC;AACT,UAAI,CAAC,GAAG,GAAG,GAAG,CAAC;KAChB;;;WAES,oBAAC,GAAG,EAAE,IAAI,EAAC;AACnB,UAAI,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAC;AACxB,eAAO,KAAK,CAAC;OACd;;AAED,aAAQ,IAAI,CAAC,KAAK,CAAC,IAAI,KAAK,GAAG,IAAK,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,AAAC,CAAC;KACvF;;;WAEW,sBAAC,IAAI,EAAE,MAAM,EAAC;;;;AAIxB,UAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AAC5C,UAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;;AAErC,aAAO,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;KAErC;;;WAEO,kBAAC,QAAQ,EAAE,GAAG,EAAC;AACrB,UAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAC;AAChB,YAAG,CAAC,CAAC,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,EAAC;AAC1C,iBAAO,IAAI,CAAC;SACb;OACF,MAAM,IAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,EAAC;AACjC,eAAO,IAAI,CAAC;OACb;;AAED,aAAO,KAAK,CAAC;KACd;;;WAEgB,2BAAC,OAAO,EAAC;;;AAExB,UAAG,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAC;AACrB,eAAO,KAAK,CAAC;OACd;;;AAGD,UAAI,KAAK,GAAG,IAAI,CAAC;AACjB,OAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAA,UAAC,CAAC,EAAG;AACtB,YAAI,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,MAAK,KAAK,CAAC,OAAO,EAAE,UAAC,CAAC,EAAG;AAC3C,iBAAO,CAAC,CAAC,SAAS,KAAK,CAAC,CAAC,SAAS,CAAC;SACpC,CAAC,CAAC;;AAEH,YAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAC;AACrC,eAAK,GAAG,KAAK,CAAC;SACf;OACF,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;AAEd,aAAO,KAAK,CAAC;KACd;;;WAEW,sBAAC,OAAO,EAAC;;;AACnB,UAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;AAC7B,aAAO,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,EAAC,GAAG,EAAC,KAAK,EAAC,CAAC,CAAC;AACxC,UAAI,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;;AAEvB,UAAG,OAAO,CAAC,MAAM,GAAG,CAAC,EAAC;AACpB,SAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAA,UAAC,MAAM,EAAG;AAC3B,gBAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAA,UAAC,CAAC,EAAG;AAC1B,mBAAO,OAAK,YAAY,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,MAAM,CAAC,CAAC;WACpD,CAAA,CAAC,IAAI,QAAM,CAAC,CAAC;SAEf,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;OACf;;AAED,UAAI,CAAC,KAAK,CAAC,YAAY,GAAG,MAAM,CAAC;AACjC,aAAO,MAAM,CAAC;KACf;;;WAEU,qBAAC,GAAG,EAAC;AACd,UAAG,IAAI,CAAC,IAAI,EAAC;AACX,eAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,UAAC,CAAC,EAAG;;AAE3B,iBAAO,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SAC7C,CAAC,CAAC;OACJ;AACD,aAAO,IAAI,CAAC;KACb;;;WAEK,gBAAC,QAAQ,EAAC;AACd,UAAI,GAAG,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAC,CAAC,EAAG;AAC1B,eAAO,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;OACpB,CAAC,CAAC;;AAEH,aAAO,GAAG,CAAC,IAAI,EAAE,CAAC;KACnB;;;WAEQ,mBAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAC;;;;AAExB,UAAI,KAAK,GAAG,IAAI,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACjC,UAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,CAAA,UAAC,CAAC,EAAG;AAC5B,eAAO,OAAK,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;OACvC,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;AAEd,UAAI,CAAC,KAAK,CAAC,IAAI,GAAK,GAAG,CAAC;AACxB,UAAI,CAAC,KAAK,CAAC,IAAI,GAAK,IAAI,CAAC;AACzB,UAAI,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;;AAE3B,aAAO,MAAM,CAAC;KACf;;;WAEQ,mBAAC,IAAI,EAAE,IAAI,EAAC;AACnB,UAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAC;AACjB,YAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,UAAC,CAAC,EAAE,CAAC,EAAG;AAC5B,iBAAO,CAAC,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;SAC5B,CAAC,CAAC;AACH,eAAO,GAAG,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;OACxC,MAAM;AACL,eAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;OACvB;KACF;;;WAEQ,mBAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC;AAC1B,UAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;;AAExC,UAAG,MAAM,EAAC;AACR,eAAQ,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAE;OAC5C;;AAED,aAAO,IAAI,CAAC;KACb;;;WAEK,gBAAC,GAAG,EAAE,IAAI,EAAE,OAAO,EAAC;AACxB,UAAI,MAAM,YAAA,CAAC;AACX,UAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAC;AAC/D,eAAO,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;OAC9B;;AAED,YAAM,GAAG,AAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,GAAI,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;;;AAGlG,UAAG,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAC;AACjB,cAAM,GAAI,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;OAC7C;;AAED,UAAI,CAAC,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC;AAC/B,aAAO,MAAM,CAAC;KAEf;;;SApLG,QAAQ;GAAS,WAAW;;AAuLlC,MAAM,CAAC,OAAO,GAAG,QAAQ,CAAC","file":"data_fcty.js","sourcesContent":["\nconst _           = require(\"lodash\");\nconst DataManager = require(\"datamanager\");\n\nclass DataFcty extends DataManager {\n\n  init(){\n    this.cache = {};\n    this.pagination = 50;\n    this.page       = 1;\n    this.itemNo     = 0;\n    this.current_search = null;\n  }\n\n  checkDataIds(d){\n    if(_.isArray(d)){\n      return !_.isEmpty(d);\n    } else {\n      return _.isNumber(d);\n    }\n  }\n\n  addSelected(ids){\n    if(this.checkDataIds(ids)){\n      this.addToHistory();\n      this.data = this.data.map((d)=>{\n        let selected = false;\n        let id = d.get(\"id\");\n        if(_.isArray(ids)){\n          selected = _.contains(ids, id);\n        } else {\n          selected = ids === id;\n        }\n\n        d = d.set(\"selected\", selected);\n        return d;\n      });\n    }\n\n  }\n\n  setApi(uri){\n    this.url = uri;\n  }\n\n  checkCache(val, keys){\n    if (_.isEmpty(this.cache)){\n      return false;\n    }\n    // console.log(this.cache)\n    return  this.cache.text === val && (_.difference(keys, this.cache.keys).length === 0);\n  }\n\n  checkFilters(opts, filter){\n    // let check = false;\n    // _.forEach(filters, (filter)=>{\n    // console.count()\n    let selected = this.getIds(filter.selected);\n    let ids = opts.get(filter.filter_by);\n\n    return this.checkIds(selected, ids);\n\n  }\n\n  checkIds(selected, ids){\n    if(_.isArray(ids)){\n      if(_.intersection(selected, ids).length > 0){\n        return true;\n      }\n    } else if(_.include(selected, ids)){\n      return true;\n    }\n\n    return false;\n  }\n\n  checkCacheFilters(filters){\n\n    if(!this.cache.filters){\n      return false;\n    }\n\n    // f = this.cache.filters\n    let check = true;\n    _.forEach(filters, (f)=>{\n      let cached = _.find(this.cache.filters, (c)=>{\n        return c.filter_by === f.filter_by;\n      });\n\n      if(!f.selected.equals(cached.selected)){\n        check = false;\n      }\n    }.bind(this));\n\n    return check;\n  }\n\n  filterSearch(filters){\n    this.cache.filters = filters;\n    filters = _.where(filters, {all:false});\n    let search = this.data;\n\n    if(filters.length > 0){\n      _.forEach(filters, (filter)=>{\n        search = search.filter((d)=>{\n          return this.checkFilters(d.get(\"filters\"), filter);\n        }.bind(this));\n\n      }.bind(this));\n    }\n\n    this.cache.filterSearch = search;\n    return search;\n  }\n\n  filterByIds(ids){\n    if(this.data){\n      return this.data.filter((d)=>{\n        // console.log(ids, d.get(\"id\"));\n        return _.contains(ids, Number(d.get(\"id\")));\n      });\n    }\n    return null;\n  }\n\n  getIds(selected){\n    let ids = selected.map((s)=>{\n      return s.get(\"id\");\n    });\n\n    return ids.toJS();\n  }\n\n  getSearch(data, val, keys){\n    //Do search\n    let regex = new RegExp(val, \"i\");\n    let search = data.filter((d)=>{\n      return this.searchTxt(regex, d, keys);\n    }.bind(this));\n\n    this.cache.text   = val;\n    this.cache.keys   = keys;\n    this.cache.search = search;\n\n    return search;\n  }\n\n  getValues(data, keys){\n    if(keys.length > 1){\n      let all = data.filter((v, k)=>{\n        return _.contains(keys, k);\n      });\n      return all.valueSeq().toJS().join(\" \");\n    } else {\n      return data.get(keys);\n    }\n  }\n\n  searchTxt(regex, data, keys){\n    let values = this.getValues(data, keys);\n\n    if(values){\n      return (String(values).search(regex) > -1);\n    }\n\n    return true;\n  }\n\n  search(val, keys, filters){\n    let search;\n    if(this.checkCache(val, keys) && this.checkCacheFilters(filters)){\n      return this.cache.fullSearch;\n    }\n    //Runs filters over data\n    search = (this.checkCacheFilters(filters)) ? this.cache.filterSearch : this.filterSearch(filters);\n\n    //Runs Search over data\n    if(!_.isEmpty(val)){\n      search =  this.getSearch(search, val, keys);\n    }\n\n    this.cache.fullSearch = search; // Caches search\n    return search;\n\n  }\n}\n\nmodule.exports = DataFcty;\n"]}